
<!--
- Spatial odor localization thresholds (the one I'm interested in):

This test also involves a set of vials, all containing the same odor but at different concentrations. The aim is to determine the lowest concentration at which the participant is able to tell which nostril is being stimulated by an odor. In each trial, two vials are presented to the participant simultaneously. One is placed under the right nostril and the other under the left nostril. One contains a scent and the other does not. The participant must then say which nostril the scent was presented in. They must say whether it was the right or the left. Depending on their answer, we determine whether their answer is correct or not. Depending on the accuracy of the answer, they are then presented with a vial with a same, lower or higher concentration. For this test, the order in which the right or left nostril is stimulated with the scented vial is random (the other vial is always an odorless vial). This is therefore information that the experimenter must know, in addition to the number of the vial to be used.

 

I'm not familiar with the quest method, but for the staircase method, the rules for moving from one concentration to another are strict: you start with the lowest concentration. Then, if the answer is negative, you present the bottle with not the concentration just above, but the one above that. And so on until the participant has two correct answers in a row. When they have two correct answers in a row, you take the bottle with the lower concentration and continue until they give an incorrect answer (only one incorrect answer is required). Then take the bottle with the concentration just above it, and so on until the participant gets two correct answers. Continue until the change in concentration direction (moving towards higher or lower concentrations) has occurred six times. The threshold is determined by averaging the last four concentrations at which the change in direction occurred.

I attached an example to this email. Ia have also found a pdf describing the detection threshold test using staircase method with the sniffin sticks devices, it could help

 

-->
<!DOCTYPE html>
<html>
  <head>
    <script src="../dist/jsQuestPlus.js"></script>
    <script src="../src/jspsych.js"></script>
    <script src="../src/plugin-html-button-response.js"></script>
    <script src="../src/plugin-html-keyboard-response.js"></script>
    <script src="../dist/jsQuestPlus.js"></script>
    <link rel="stylesheet" href="../src/jspsych.css">
  </head>
  <body></body>
  <script>
        const jsPsych = initJsPsych()
        console.log(`jsPsych Version ${jsPsych.version()}`)

    const instruction = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `<p>This program demonstrates how to use jsQuestPlus  </p>`,
        choices: ['START']
    }
    // Psychometric function corresponding to the first response (response = 0).
    function func_respYES(stim, threshold, slope, guess, lapse) {
        return guess + (1 - guess - lapse )*Math.exp(-Math.pow(stim/threshold,slope))
    }

    // Psychometric function corresponding to the second response (response = 1).
    function func_respNO(stim, threshold, slope, guess, lapse) {
        return 1 - func_respYES(stim, threshold, slope, guess, lapse) 
    }
    
    // Specifiy the space of all possible stimuli
    // The 101 is the number of values to split the span of 0 to 10 into.
    // 101 ensures that integrer values exist
    var contrast_samples = jsQuestPlus.linspace(0,10,101)
    // For some reason the psychometric function does not like zero so this is changed to almost zero
    contrast_samples[0] = 0.1        
    const threshold_samples = contrast_samples
    const slope = [3.5] // Don't forget to add brackets, i.e., specify as an array.
    // There are three bottles and people have to pick one of the three. 
    // There is a 33% chance of being correct. The guess rate is therefore 0.33
    const guess = [0.5]
    const lapse = [0.01]
    // Specify the starting information    
    
    var StartingGuess = 7.5
    var StartingStandardDeviation = 20
    const threshold_prior = jsQuestPlus.gauss(threshold_samples, StartingGuess, StartingStandardDeviation)

    // Specify the Quest
        const jsqp = new jsQuestPlus({
        psych_func:  [func_respYES, func_respNO], 
        stim_samples: [contrast_samples], 
        psych_samples: [threshold_samples, slope, guess, lapse],
        //priors: [threshold_prior]
        priors: jsQuestPlus.set_prior([threshold_prior, slope.length, guess.length, lapse.length]),
    })

    let trial_num = 1
    const trialsDesired = 20
    let BottleNum = -99
    const trialBUT = {

    type: jsPsychHtmlButtonResponse,
    stimulus: function(){
        
        stim = jsqp.getStimParams()
        stim = Math.round(stim)
        if (stim == 0)
        { 
            stim = contrast_samples[0]
            BottleNum = 0
        } 
        else { 
            BottleNum = stim 
        }
        console.log('STIM: '+stim)
        console.log('Estimates: ')
        console.log(jsqp.getEstimates())
        // Return the stimulus with the parameters suggested by jsQuestPlus.
        return `<p>Simulation trial = ${trial_num}/${trialsDesired}</p>
            <p>Bottle Number = ${BottleNum}</p>
            <p>Current Threshold Estimate = ${jsqp.getEstimates()[0]}</p> `
        },
        choices: ['Left', 'Right'],
        on_finish(data){
            console.log("RESPONSE")
            console.log(data.response)
            jsqp.update(stim, data.response)
        }
    }

    const loop_node = {
        timeline: [trialBUT],
        loop_function: function(data){
            if (trial_num < trialsDesired){
                trial_num++
                return true
            } else {
                return false
            }
        }
    }

    const briefing = {
        type: jsPsychHtmlButtonResponse,
        stimulus: function(){
            const estimates = jsqp.getEstimates()
            console.log(estimates)
            return `<p>Final threshold estimate is ${estimates[0]}.</p>`

        },
        choices: ['Finish']
    }

    jsPsych.run([instruction, loop_node, briefing])

  </script>
</html>